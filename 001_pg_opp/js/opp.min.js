(function(){window.opp={init:function(){var d={production:{n:function(){return{nodeChar:"E"}},"(E)":function(){return{nodeChar:"E"}},"E+E":function(){return{nodeChar:"E",op:"+"}},"E-E":function(){return{nodeChar:"E",op:"-"}},"E*E":function(){return{nodeChar:"E",op:"*"}},"E/E":function(){return{nodeChar:"E",op:"/"}},"E^E":function(){return{nodeChar:"E",op:"^"}}},fgIndexMap:{"+":1,"-":2,"*":3,"/":4,"^":5,"(":6,")":7,n:8,$:9},fMap:{"+":2,"-":2,"*":4,"/":4,"^":5,"(":0,")":11,n:11,$:0},gMap:{"+":1,"-":1,
"*":3,"/":3,"^":6,"(":10,")":0,n:10,$:0},init:function(){this.panels.lex.lexButton.onclick();this.vars.addChangeVarListener(function(a,e,b){"pair"===e&&(a.panels.stackTable.clearClassName(),a.panels.stackTable.setClassName("selected-1",0,b.b1I),a.panels.stackTable.setClassName("selected-1",0,b.b2I),a.comment(12,d.createCompStr(a,b.b1,b.b2)))})},setup:function(){var a=d.tokens;this.vars("input",a.slice(0));this.vars("bI",-1);this.vars("stack",[{nodeChar:"$",toString:function(){return this.nodeChar}}]);
this.panels.lexTable.clearClassName();this.panels.stackTable.deleteAll();this.panels.stackTable.insertRow(["$"]);this.panels.precTable.clearClassName();a={nodeText:"dummy",children:a.slice(0,a.length-1)};d.vtree.root(a).update();this.panels.codeTable.removeAllComments()},f:function(a){return d.fMap[a.nodeChar]},g:function(a){return d.gMap[a.nodeChar]},nextInput:function(){var a=this.vars("input"),e=a.shift();this.vars("input",a);var b=this.vars("bI")+1;this.vars("bI",b);this.panels.lexTable.clearClassName();
this.panels.lexTable.setClassName("selected",0,b);this.varComment("b",e.nodeChar,"input",d.tokens2str(a));9===this.pos[0]&&this.removeComment(1);return e},stackPush:function(a){var e=this.vars("stack");e.push(a);this.vars("stack",e);this.panels.stackTable.insertColumn([a.nodeChar]);this.varComment("stack",d.tokens2str(e));this.removeComment(17);8===this.pos[0]?this.removeComment(18):this.removeComment(8)},getTopTerminal:function(a){for(var e=a.length-1;0<=e;e--){var b=a[e];if("E"!==b.nodeChar){this.panels.stackTable.clearClassName();
this.panels.stackTable.setClassName("selected",0,e);a=b;var e=this.vars("b"),b=a.nodeChar,c=e.nodeChar;this.varComment("a",b);"$"===b&&"$"===c?(this.comment(5,"True"),this.removeComment(7)):(this.comment(5,"False"),this.comment(7,d.createCompStr(this,a,e)));return a}}throw"not found terminal symbol in the stack";},getAllTerminalPairs:function(a){for(var e=[],b=a.length-1;0<=b;b--){var d=a[b];if("E"!==d.nodeChar)for(var c=b-1;0<=c;c--){var h=a[c];if("E"!==h.nodeChar){var f={};f.b1I=c;f.b1=h;f.b2I=
b;f.b2=d;e.push(f);break}}}return e},getHandle:function(a,e){var b=e+1,c=a.length-b,f=a.slice(b);this.vars("stack",a.slice(0,b));for(b=0;b<c;b++)this.panels.stackTable.deleteColumn();this.panels.stackTable.clearClassName();this.varComment(14,"handle",d.tokens2str(f));return f},reduce:function(a,e){var b=d.tokens2str(a),b=d.production[b];if(!b)return null;b=b();if(b.op){var c=a[0].num,f=a[2].num;"+"===b.op?b.num=c+f:"-"===b.op?b.num=c-f:"*"===b.op?b.num=c*f:"/"===b.op?b.num=c/f:"^"===b.op&&(b.num=
Math.pow(c,f))}else b.num=1===a.length?a[0].num:a[1].num;b.className="node-type-5";b.children=a;b.nodeText=""+b.num;d.vtree.root().children.splice(e,a.length,b);d.vtree.update();b?this.comment(17,'True, nonterminal = "E"'):this.comment(17,"False");return b},createCompStr:function(a,e,b){var c=e.nodeChar,f=b.nodeChar;e=d.f(e);b=d.g(b);var h=e===b?" == ":e<b?" < ":" > ",g=e<=b?"True":"False";a.panels.precTable.clearClassName();a.panels.precTable.setClassName("selected-2",1,d.fgIndexMap[c]);a.panels.precTable.setClassName("selected-2",
2,d.fgIndexMap[f]);return[g,', f("',c,'"): ',e,h,'g("',f,'"): ',b].join("")},tokens2str:function(a){var e=[];a.forEach(function(a){e.push(a.nodeChar)});return e.join("")}},c=new sc.StepCells({},[[[20,"setup",[]]],[[4,[15,"b"],[20,"nextInput",[]]]],[[0],1,[26,22,4]],[[4,[15,"a"],[20,"getTopTerminal",[[15,"stack"]]]]],[],[[1,[9,[28,[15,"a"],"nodeChar"],"$"],[9,[28,[15,"b"],"nodeChar"],"$"]],[26,7,1]],[[22,22,4]],[[25,22,2],[0],[12,[20,"f",[[15,"a"]]],[20,"g",[[15,"b"]]]],[26,10,1]],[[20,"stackPush",
[[15,"b"]]]],[[4,[15,"b"],[20,"nextInput",[]]]],[[25,22,1],[0]],[[4,0,[29,[20,"getAllTerminalPairs",[[15,"stack"]]],"slice",[0]]],[0],[27,[15,"pair"],0],[26,15,4]],[[11,[20,"f",[[28,[15,"pair"],"b1"]]],[20,"g",[[28,[15,"pair"],"b2"]]]],[26,15,1]],[[22,15,4]],[],[[25,15,2],[0],[0],[25,11,1],[0],[4,[15,"handle"],[20,"getHandle",[[15,"stack"],[28,[15,"pair"],"b1I"]]]]],[[4,[15,"nonterminal"],[20,"reduce",[[15,"handle"],[28,[15,"pair"],"b1I"]]]]],[[15,"nonterminal"],[26,19,1]],[[20,"stackPush",[[15,"nonterminal"]]]],
[[25,22,0],[0]],[[20,"pause",[]]],[],[[0],[0],[0],[25,2,0],[0]]],d),k=document.getElementById("buttonsContainer"),l=document.getElementById("treeContainer"),m=document.getElementById("lexContainer"),n=document.getElementById("codeTable"),p=document.getElementById("lex-result"),h=document.getElementById("stack"),g=document.getElementById("prec"),f=document.getElementById("message");c.panels.buttons=new sc.panels.Buttons(c,{container:k,showRunButton:!0});c.panels.tree=new sc.panels.Tree(c,{container:l,
width:380,height:420});c.panels.lex=new sc.panels.Lex(c,{container:m});c.panels.stackTable=new sc.panels.Table(c,{table:h});c.panels.precTable=new sc.panels.Table(c,{table:g});c.panels.codeTable=new sc.panels.CodeTable(c,{codeTable:n});c.panels.lexTable=new sc.panels.Table(c,{table:p});c.addErrorListener(function(a,e){f.innerHTML=e});d.init&&d.init.call(c);c.reset()}}})();(function(){function d(d,h,g){g=g.container;helpers.addClass(g,"sc-lex-panel");g.innerHTML="\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\uff1a<input class='sc-lex-src' type='text' value='(3 + 4) * 2' style='width: 16em;' /><input class='sc-lex-button' type='button' value='\u5b57\u53e5\u89e3\u6790' /><div class='sc-lex-message'></div>";var f=g.getElementsByClassName("sc-lex-src")[0],a=g.getElementsByClassName("sc-lex-message")[0];d.lexButton=g.getElementsByClassName("sc-lex-button")[0];d.lexButton.onclick=
function(){try{var e=c(f.value)}catch(b){e=[{nodeChar:"$",className:"node-type-5",toString:k}],a.innerHTML=b}h.js.tokens=e;h.reset();var d=[];e.forEach(function(a){d.push(a.nodeChar)});h.panels.lexTable.deleteAll();h.panels.lexTable.insertRow(d)}}function c(c){for(var d=0,g=[];;){if(d>=c.length){g.push({nodeChar:"$",className:"node-type-5",toString:k});break}var f=c.substr(d),a=l.exec(f);a&&(d+=a[1].length,f=c.substr(d));if(a=n.exec(f)){f=0;if("("===a[1]||")"===a[1])f=3;else if("+"===a[1]||"-"===
a[1])f=4;else if("*"===a[1]||"/"===a[1])f=2;g.push({nodeChar:a[1],className:"node-type-"+f,toString:k});d+=a[1].length}else if(a=m.exec(f))f=parseInt(a[1]),g.push({nodeChar:"n",className:"node-type-1",nodeText:""+f,num:f,toString:k}),d+=a[1].length;else throw["(pos ",d+1,") unknown token: "+f[0]].join("");}return g}function k(){return this.nodeChar}sc.panels.Lex=function(c,h){d(this,c,h)};var l=/^([ \t]+)/,m=/^(\d+)/,n=/^([\+\-\*\/\(\)^])/})();
